var fpconfig={n:3,e:[{e:"a-ring.msedge.net",w:20,m:1},{e:"b-ring.msedge.net",w:20,m:1},{e:"acdc-direct.office.com",w:20,m:1},{e:"gtm-dyn-direct.office365.com",w:20,m:1},{e:"canary.trafficmanager.net",w:20,m:1},{e:"outlook.office365.com",w:20,m:1},{e:"outlook.office.com",w:20,m:1},{e:"outlook.live.com",w:20,m:1},{e:"*.nrb.footprintdns.com",w:1e6,m:1}],r:["fpc.msedge.net/r.gif","footprintc.azureedge.net/r.gif"]};Footprint=function(){function start(monitorID,configUrls,requestDelay,tag){if(tag===void 0){tag=""}if(!monitorID||monitorID.trim().length===0||Number(requestDelay)!==requestDelay||requestDelay%1!==0||requestDelay<0){return}var maxTagLength=200;var tagExists=tag.trim().length>0;if(tagExists&&tag.trim().length>maxTagLength){tag=tag.trim().substr(0,maxTagLength)}var localProtocol=window.location.protocol+"//";if(!JSON||!XMLHttpRequest){return}var warmupImg="trans.gif";var requestTimeout=2e3;var reportVersion="2017061301";var w3cEnabled=w3cResourceEnabled();var reportId=probeId();var reportParams="MonitorID="+monitorID+"&rid="+reportId+"&w3c="+w3cEnabled+"&prot="+window.location.protocol+"&v="+reportVersion+(tagExists?"&tag="+tag:"")+"&DATA=";var configureAndRun=function(){var configuration=configureMeasurements(fpconfig,localProtocol);if(configuration.length===0){return}var urls=generateMeasurements(configuration,localProtocol,warmupImg);var reportUrls=[];for(var i in fpconfig.r){reportUrls.push(localProtocol+fpconfig.r[i]+"?"+reportParams)}flight(urls,requestTimeout,requestDelay,reportUrls,null)};if(typeof fpconfig==="undefined"){for(var i in configUrls){configUrls[i]=localProtocol+configUrls[i]}var configRequestComplete=function(req){fpconfig=JSON.parse(req.responseText);configureAndRun()};fallbackRequest(configUrls,0,"GET",configRequestComplete)}else{configureAndRun()}}function fallbackRequest(urls,urlIndex,method,onComplete){if(method!=="GET"&&method!=="POST"){method="GET"}var req=new XMLHttpRequest;req.onreadystatechange=function(){if(this.readyState===4&&this.status===200&&onComplete!=null){onComplete(this)}};var failure=function(){if(urlIndex++<urls.length){fallbackRequest(urls,urlIndex,method,onComplete)}};req.onerror=failure;var url=urls[urlIndex];req.open(method,url,true);req.send()}function configureMeasurements(fpconfig,localProtocol){var httpsFlag=1;var httpFlag=2;var seventeenKFlag=12;var protocolType=localProtocol.toLowerCase()==="http://"?httpFlag:httpsFlag;var idsWithWeights=[];var totalWeight=0;for(var i in fpconfig.e){var entry=fpconfig.e[i];if(entry.w>0&&entry.m&protocolType){totalWeight+=entry.w;idsWithWeights.push({endpoint:entry.e,cumWeight:totalWeight,weight:entry.w,measurementType:entry.m})}}var config=[];var idCount=Math.min(fpconfig.n,idsWithWeights.length);while(config.length<idCount){var randomWeight=Math.floor(Math.random()*totalWeight);var randomItem=null;for(var item in idsWithWeights){if(randomItem==null){if(randomWeight<=idsWithWeights[item].cumWeight){randomItem=idsWithWeights[item];delete idsWithWeights[item]}}else{idsWithWeights[item].cumWeight-=randomItem.weight}}totalWeight-=randomItem.weight;var testImage=randomItem.measurementType&seventeenKFlag?"17k.gif":"trans.gif";config.push({id:randomItem.endpoint,testImage:testImage})}return config}function generateMeasurements(config,localProtocol,warmupImg){var urlIds=[];for(var i in config){var id=config[i].id;var testImg=config[i].testImage;var testurl=localProtocol+id;if(id.indexOf(".")===-1){testurl+=".clo.footprintdns.com"}else if(id.charAt(0)==="*"){var fqdn=id.substring(2);var guid=probeId();testurl=localProtocol+guid+"."+fqdn;id=fqdn==="clo.footprintdns.com"||fqdn==="nrb.footprintdns.com"?guid:fqdn}testurl+="/apc/";var coldUrl=testurl+warmupImg+"?"+probeId();urlIds.push({url:coldUrl,requestID:id,object:warmupImg,conn:"cold"});var warmUrl=testurl+testImg+"?"+probeId();urlIds.push({url:warmUrl,requestID:id,object:testImg,conn:"warm"})}return urlIds}function createReport(loadTimes,urlIds){var results=[];for(var i=0;i<urlIds.length;i++){for(var i=0;i<urlIds.length;i++){results.push({RequestID:urlIds[i].requestID,Object:urlIds[i].object,Conn:urlIds[i].conn,Result:Math.round(loadTimes[i])})}}return JSON.stringify(results)}function probeId(){function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return s4()+s4()+s4()+s4()+s4()+s4()+s4()+s4()}function w3cResourceEnabled(){return window.performance&&window.performance.getEntriesByName?true:false}function flight(urls,reqTimeout,reqDelay,reportUrls,onComplete){var startTime;var timeoutId;var loadTimes=[];var nextIndex=0;var numberProbesSent=0;var target;var indexOfFirstProbe=0;function doProbe(nextIndex){if(timeoutId!=null){clearTimeout(timeoutId)}if(startTime!=null){loadTimes[nextIndex]=(new Date).getTime()-startTime}else{loadTimes[nextIndex]=-1}nextIndex=(numberProbesSent+indexOfFirstProbe)%urls.length;target=new Image;if(numberProbesSent++<urls.length){startTime=(new Date).getTime();target.onload=function(){doProbe(nextIndex)};var errorHandler=function(){target.onload=null;target.onerror=null;startTime=null;doProbe(nextIndex)};timeoutId=setTimeout(function(){errorHandler()},reqTimeout);target.onerror=function(){if(timeoutId!=null){clearTimeout(timeoutId)}timeoutId=null;errorHandler()};target.src=urls[nextIndex].url}else{if(reportUrls!=null&&reportUrls.length!==0){if(w3cResourceEnabled()){for(var i=0;i<urls.length;i++){var testUrl=urls[i].url;var perfEntryArray=window.performance.getEntriesByName(testUrl);if(loadTimes[i]!==-1&&perfEntryArray&&perfEntryArray[0]){loadTimes[i]=perfEntryArray[0].duration}}}var reportStr=createReport(loadTimes,urls);var reportRequests=[];for(var j=0;j<reportUrls.length;j++){var reportRequest=reportUrls[j]+reportStr;reportRequests.push(reportRequest)}fallbackRequest(reportRequests,0,"GET",null)}if(onComplete!=null){onComplete()}}}setTimeout(function(){doProbe(0)},reqDelay)}return{start:start}}();