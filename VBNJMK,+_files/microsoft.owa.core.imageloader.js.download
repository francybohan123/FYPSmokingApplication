window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['microsoft.owa.core.imageloader.js'] = (new Date()).getTime();
Type.registerNamespace("Microsoft.Owa.Core.ImageLoader");Microsoft.Owa.Core.ImageLoader.c=function(n,t,i,r){Microsoft.Owa.Core.ImageLoader.c.initializeBase(this,[n]);this.i=t;this.g=r;this.e=i;this.f=new Microsoft.Owa.Core.ImageLoader.d(this.e)};Microsoft.Owa.Core.ImageLoader.c.prototype={i:null,e:null,g:null,f:null,a:function(n,t){var i=n;var s=this.c(i,"data-custom");if(_j.h.a(s))return!1;if(n.onerror&&n.onload)return!0;var o=Microsoft.Owa.Core.ImageLoader.a.a();var f=new _g.bd(decodeURIComponent(s));var u=this.c(i,"explicitLogon");var h=null;var e=null;if(this.e.a().fb().Enabled){h=_g.B.c()+"&animation=true";e=_g.B.b()+"&animation=true"}var r=this;this.g.c(function(s){var c=s.a(u);if(r.e.a().bK().Enabled){i.setAttribute("data-downloadImage",c.b(f,!1,!0,_g.B.a(),u));i.setAttribute("data-thumbnailImage",c.b(f,!1,!1,e,u))}var l=c.b(f,!1,!1,h,u);_j.h.b(l)?r.d(o,i,"NullAttachmentUrl",null,t,null,null,null,!1,!1):r.b(n,l,t,function(){r.i.a(_a.cD,new _a.cD("II"));!r.c(i,"width")&&_j.h.a(i.style.width)&&_j.k.a(i,"max-width","100%")},null,o)},!1);return!0},b:function(n,t,i,r,u,f){var h=f||Microsoft.Owa.Core.ImageLoader.a.a();var c=this.f.b(t);var l=c?"CrossDomain":"SameDomain";var e=c?this.f.a(n,t):null;var s=n;var o=this.c(s,"data-imagetype");_j.h.a(o)&&(o="AttachmentByCid");var v=this,a=this;this.j(s,t,function(){v.d(h,s,n.naturalWidth>0?"":"ZeroNaturalWidth",o,i,l,_j.h.a(e)?"NoCors":e,null,!1,!1);r&&r()},function(){var n=!_j.h.a(e)&&e.toLowerCase()==="use-credentials";a.d(h,s,"OnError",o,i,l,_j.h.a(e)?"NoCors":e,t,!0,n);u&&u()});return!0}};Microsoft.Owa.Core.ImageLoader.e=function(n,t,i){this.i=Function.createDelegate(this,this.p);Microsoft.Owa.Core.ImageLoader.e.initializeBase(this,[n]);this.b=t;this.g=i;this.e=new Array(0);this.f=!1;this.r()};Microsoft.Owa.Core.ImageLoader.e.prototype={b:null,g:null,e:null,f:!1,a:function(n,t){if(this.f)return!1;var r=n;var i=this.c(r,"data-custom");if(_j.h.a(i))return!1;this.n(n,i);return!0},n:function(n,t){if(this.l()){var i=this;this.q(decodeURIComponent(t),function(r){if(r)n.src=r.getUri();else{i.g.b(t,n);i.g.a()}})}else Array.add(this.e,new Microsoft.Owa.Core.ImageLoader.e.a(n,t))},l:function(){return this.b.d()&&this.b.b().o()},r:function(){var t=this;this.b.a(function(n){n.n(t.i)});var n=this;_j.m.a().a(_a.a.S,"SubscribeItemStore_OnAvailable",function(){n.b.d()&&n.o(n.b.b());n.f=!n.l();n.m()},1e4)},o:function(n){n.q(this.i)},p:function(n){this.o(n);this.m()},q:function(n,t){var i=null;var r=this,f=this,u=this;this.b.b().k("InlineImageLoader.LoadImageFromStore",function(t){r.b.b().bindIn(t,r.b.b().h().b(n),function(n){i=n},null)},function(){t(i)},function(){t(i)})},m:function(){for(var i=this.e,r=i.length,n=0;n<r;++n){var t=i[n];this.n(t.b,t.a)}this.e=new Array(0)}};Microsoft.Owa.Core.ImageLoader.e.a=function(n,t){this.b=n;this.a=t};Microsoft.Owa.Core.ImageLoader.e.a.prototype={b:null,a:null};Microsoft.Owa.Core.ImageLoader.f=function(n,t,i,r,u,f){Microsoft.Owa.Core.ImageLoader.f.initializeBase(this,[!1]);this.b=new Array(0);n.a()&&this.b.push(new Microsoft.Owa.Core.ImageLoader.e(!1,t,i));this.b.push(new Microsoft.Owa.Core.ImageLoader.c(!0,r,u,f));this.b.push(new Microsoft.Owa.Core.ImageLoader.i(!1));this.b.push(new Microsoft.Owa.Core.ImageLoader.g(!1))};Microsoft.Owa.Core.ImageLoader.f.prototype={b:null,a:function(n,t){if(_a.n.a().J){this.f(n,t,0);return!0}else return this.e(n,t)},f:function(n,t,i){if(this.g(n))if(i<=10){i++;var o=this;_j.m.a().a(_a.a.bN,"Retry loading inline image",function(){o.f(n,t,i)},100*i)}else{var r=n;var s=Microsoft.Owa.Core.ImageLoader.a.a();var e=this.c(r,"data-imageerror");var u=this.c(r,"originalSrc");var f=this.c(r,"data-imagetype");if(!_j.h.a(e)){this.d(s,r,"ErrorProjectionTimeout",f,t,"","",u,!1,!1);this.h(r);r.src=_j.h.a(u)?"":u}}else this.e(n,t)},e:function(n,t){for(var r=!1,i=0;i<this.b.length;i++)if(r=this.b[i].a(n,t))break;return r},g:function(n){var i=this;var t=_j.i.c(n,function(n){return n.className==="projectionConductorsContainer"});return!!t}};Microsoft.Owa.Core.ImageLoader.d=function(n){this.e=new RegExp("^https?://([^/]*)/.*","i");this.d=window.location.hostname.toLowerCase();this.c=this.f(n?n.a().jg():null)};Microsoft.Owa.Core.ImageLoader.d.prototype={d:null,c:null,a:function(n,t){var i=n&&this.c&&t&&this.b(t)?this.c:null;i&&(n.crossOrigin=i);return i},b:function(n){var t=_j.h.a(n)?null:n.match(this.e);return!!t&&t.length>1&&t[1].toLowerCase()!==this.d},f:function(n){var t=n&&n.CrossOrigin?n.CrossOrigin.toLowerCase():null;if(t)switch(t){case"anonymous":case"use-credentials":break;default:t=null;break}return t}};Microsoft.Owa.Core.ImageLoader.a=function(){};Microsoft.Owa.Core.ImageLoader.a.a=function(){return _a.b.b(_a.a.bN,"InlineImageLoad",!1,null)};Microsoft.Owa.Core.ImageLoader.a.c=function(n,t,i,r,u,f){if(n){var e=new _a.l;e.b("TP",_j.h.d(i)?"":i);e.b("LDR",_j.h.d(r)?"":r);e.b("CTX",_j.h.d(u)?"":u);e.b("LDRC",_j.h.d(f)?"":f);_j.h.a(t)||(n.n=t);n.m=e.toString();_a.b.a(n)}};Microsoft.Owa.Core.ImageLoader.a.b=function(n,t,i,r,u,f,e,o){var h=_a.b.b(_a.a.bN,"InlineImageLoadError",!1,null);var s=new _a.l;s.b("TP",_j.h.d(n)?"":n);s.b("LDR",_j.h.d(t)?"":t);s.b("SC",_j.h.d(r)?"":r);s.b("CTX",_j.h.d(u)?"":u);s.b("LDRC",_j.h.d(f)?"":f);s.b("OSRC",_j.h.d(e)?"":e);s.b("CT",_j.h.d(o)?"":o);_j.h.a(i)||(h.n=i);h.m=s.toString();_a.b.a(h)};Microsoft.Owa.Core.ImageLoader.g=function(n){Microsoft.Owa.Core.ImageLoader.g.initializeBase(this,[n])};Microsoft.Owa.Core.ImageLoader.g.prototype={a:function(n,t){if(n.onerror&&n.onload)return!0;var i=n;var u=Microsoft.Owa.Core.ImageLoader.a.a();var e=this.c(i,"data-imageerror");var r=this.c(i,"originalSrc");var f=this.c(i,"data-imagetype");if(!_j.h.a(e)){this.d(u,i,e,f,t,"","",r,!1,!1);this.h(i);i.src=_j.h.a(r)?"":r;return!0}var s=this,o=this;this.j(i,r,function(){s.d(u,i,null,f,t,"","",r,!1,!1)},function(){o.d(u,i,"OnError",f,t,"","",r,!0,!1)});return!0}};function ImageLoaderComponent(){}ImageLoaderComponent.$$cctor=function(){_a.t.a().a(ImageLoaderComponent)};ImageLoaderComponent.prototype={b:function(n,t,i){var f=this;n.b(_y.cl,function(){return new Microsoft.Owa.Core.ImageLoader.d(n.a(_a.e))}).b(_y.cl).a();var u=this;n.b(_y.gu,function(){return new Microsoft.Owa.Core.ImageLoader.f(n.a(_h.Z),n.d(_bc.B),n.a(_b.bA),n.a(_j.j),n.a(_a.e),n.d(_y.bB))}).b(_y.gu).a();var r=this;n.b(_y.cz,function(){return new Microsoft.Owa.Core.ImageLoader.c(!1,n.a(_j.j),n.a(_a.e),n.d(_y.bB))}).b(_y.cz).a()},a:function(){return null}};Microsoft.Owa.Core.ImageLoader.j=function(n){this.k=n};Microsoft.Owa.Core.ImageLoader.j.prototype={k:!1,a:function(n,t){return!1},j:function(n,t,i,r){var u=null;if(this.k){u=Microsoft.Owa.Core.ImageLoader.b.b(n);u.d()}var f=n;var o=this;f.onload=function(){o.h(n);if(u){u.c();u.dispose()}i()};var e=this;f.onerror=function(){e.h(n);if(u){u.c();u.dispose()}r()};n.src=t},s:function(n,t,i){var r=new XMLHttpRequest;var f=this;r.onreadystatechange=function(){if(r.readyState===4){var u=r.status.toString();var n=r.getResponseHeader("Content-Type")||"";if(n.length>0){var t=n.indexOf(";");t>0&&(n=n.substr(0,t))}i(u,n)}};var u=this;r.ontimeout=function(){i("Timemout","")};t&&(r.withCredentials=!0);r.open("GET",n,!0);r.send(null)},c:function(n,t){var i=n;return i.hasAttribute(t)?i.getAttribute(t):null},d:function(n,t,i,r,u,f,e,o,s,h){var c=_j.h.a(r)?this.c(t,"data-imagetype"):r;var l=this.c(t,"originalSrc");n&&Microsoft.Owa.Core.ImageLoader.a.c(n,i,c,f,u,e);if(_j.h.a(i)||_j.h.b(o)||!s)Microsoft.Owa.Core.ImageLoader.a.b(c,f,i,"",u,e,l,"");else{var a=this;this.s(o,h,function(n,t){Microsoft.Owa.Core.ImageLoader.a.b(c,f,i,n,u,e,l,t)})}},h:function(n){var t=n;n.removeAttribute("onload");n.removeAttribute("onerror");t.onload=t.onerror=null}};Microsoft.Owa.Core.ImageLoader.h=function(n,t){this.b=n;this.a=t};Microsoft.Owa.Core.ImageLoader.h.prototype={b:null,a:null,d:function(){if(this.b&&this.a){this.a.parentNode.insertBefore(this.b,this.a);_j.k.x(this.a)}},c:function(){if(this.b&&this.a){_j.k.e(this.b);_j.k.v(this.a)}},dispose:function(){this.b=null;this.a=null}};Microsoft.Owa.Core.ImageLoader.i=function(n){Microsoft.Owa.Core.ImageLoader.i.initializeBase(this,[n])};Microsoft.Owa.Core.ImageLoader.i.prototype={a:function(n,t){var i=n;var r=this.c(i,"data-imageproxysrc");if(_j.h.a(r))return!1;if(n.onerror&&n.onload)return!0;var e=this.c(i,"data-imageproxyid");var h=this.c(i,"originalSrc");var u=this.c(i,"data-imagetype");var f=Microsoft.Owa.Core.ImageLoader.a.a();var o=this,s=this;this.j(i,r,function(){o.d(f,i,null,u,t,"Proxy",e,r,!1,!1)},function(){s.d(f,i,"OnError",u,t,"Proxy",e,r,!0,!1)});return!0}};Microsoft.Owa.Core.ImageLoader.b=function(){};Microsoft.Owa.Core.ImageLoader.b.b=function(n){var t=n;var r=t.height<=1||t.width<=1?Microsoft.Owa.Core.ImageLoader.b.a:Microsoft.Owa.Core.ImageLoader.b.c(n);var i=_j.k.q(r)[0];return new Microsoft.Owa.Core.ImageLoader.h(i,n)};Microsoft.Owa.Core.ImageLoader.b.c=function(n){var r=n;var i=r.height;var t=r.width;var u=r.name;var e=t>160&&i>120?_b.k.o().c:_b.k.n().c;var f=String.format('<div style="background-image: url(\'{0}\'); padding-bottom: {1};  background-repeat: no-repeat; background-position: center; width: 100%; position: relative; -moz-user-select: none; -webkit-user-select: none; -ms-user-select: none;" unselectable="on"{2}></div>',_y.c.a.l(e),(i/t*100).toString()+"%",_j.h.a(u)?"":String.format(' title="{0}"',u));return String.format('<div class="ms-border-color-themePrimary" id="{0}"style="width: {1}px; height: {2}px; box-sizing: border-box; overflow: hidden; border-width: 1px; border-style: dashed; display: inline-block; -moz-user-select: none; -webkit-user-select: none; -ms-user-select: none;" unselectable="on">{3}</div>',"OWATemporaryImageDivContainer",t.toString(),i.toString(),f)};Microsoft.Owa.Core.ImageLoader.j.registerClass("Microsoft.Owa.Core.ImageLoader.j",null,_y.gu);Microsoft.Owa.Core.ImageLoader.c.registerClass("Microsoft.Owa.Core.ImageLoader.c",Microsoft.Owa.Core.ImageLoader.j,_y.cz);Microsoft.Owa.Core.ImageLoader.e.registerClass("Microsoft.Owa.Core.ImageLoader.e",Microsoft.Owa.Core.ImageLoader.j);Microsoft.Owa.Core.ImageLoader.e.a.registerClass("Microsoft.Owa.Core.ImageLoader.e.a");Microsoft.Owa.Core.ImageLoader.f.registerClass("Microsoft.Owa.Core.ImageLoader.f",Microsoft.Owa.Core.ImageLoader.j);Microsoft.Owa.Core.ImageLoader.g.registerClass("Microsoft.Owa.Core.ImageLoader.g",Microsoft.Owa.Core.ImageLoader.j);ImageLoaderComponent.registerClass("ImageLoaderComponent",null,_a.kd,_j.ce);Microsoft.Owa.Core.ImageLoader.h.registerClass("Microsoft.Owa.Core.ImageLoader.h",null,Sys.IDisposable);Microsoft.Owa.Core.ImageLoader.i.registerClass("Microsoft.Owa.Core.ImageLoader.i",Microsoft.Owa.Core.ImageLoader.j);ImageLoaderComponent.$$cctor();Microsoft.Owa.Core.ImageLoader.b.a=String.format('<div><img src="{0}"><br><p/></div>',_y.c.a.l("inlineimageplaceholder.png"));
window.scriptsLoaded['microsoft.owa.core.imageloader.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['microsoft.owa.core.imageloader.js'] = (new Date()).getTime();
